#config_version=6

config:
  - config_autofire_coils.yaml
  - config_ball_devices.yaml
  - config_ball_saves.yaml
  - config_coils.yaml
  - config_flippers.yaml
  - config_hardware_fast.yaml
  - config_lights.yaml
  - config_no_hold_flippers.yaml
  - config_switches.yaml
  - config_reversed_flippers.yaml
  - config_servos.yaml
  - variable_player.yaml
  - config_videos.yaml

modes:
  - default_sounds
  - 2x_playfield
  - attract
  - ball_save
  - base
  - battle_jester
  - bonus
  - bumpers
  - ejection_seat
  - end_of_game_attract
  - goose_letters
  - iceman_letters
  - mach_scoring
  - mig_letters
  - pilot_training_mission_afterburner
  - pilot_training_mission_inverted
  - pilot_training_mission_missiles
  - rescue_cougar
  - rise_of_phoenix
  - top_gun_service
  - shot_made_callout_randomizer
  - skillshot
  - tilt 
  - pilot_mission_qualifier

player_vars:
  mach_level:
    initial_value: 1.0
    value_type: float
  mach_step:
    initial_value: 0
    value_type: int
  tilt_warnings:
    initial_value: 0
    value_type: int
  ball_tilted:
    initial_value: 0
    value_type: int

##############################################################################
# MACHINE VARIABLES - Service mode tracking and audits
##############################################################################
machine_vars:
  # Service mode menu state - integers for logic
  service_menu_level:
    initial_value: 0
    value_type: int
    persist: false
  service_main_index:
    initial_value: 0
    value_type: int
    persist: false
  service_switch_index:
    initial_value: 0
    value_type: int
    persist: false
  service_coil_index:
    initial_value: 0
    value_type: int
    persist: false
  service_light_index:
    initial_value: 0
    value_type: int
    persist: false
  service_light_color_index:
    initial_value: 0
    value_type: int
    persist: false
  service_adjustment_index:
    initial_value: 0
    value_type: int
    persist: false
  service_audit_index:
    initial_value: 0
    value_type: int
    persist: false
  service_feature_index:
    initial_value: 0
    value_type: int
    persist: false
  # Service mode display text - strings for Godot MPFVariable nodes
  service_main_text:
    initial_value: "SWITCH TEST"
    value_type: str
    persist: false
  service_switch_name:
    initial_value: "Start Button"
    value_type: str
    persist: false
  service_switch_num:
    initial_value: "Switch 1/63"
    value_type: str
    persist: false
  service_switch_state:
    initial_value: "OPEN"
    value_type: str
    persist: false
  service_coil_name:
    initial_value: "Left Flipper"
    value_type: str
    persist: false
  service_coil_num:
    initial_value: "Coil 1/22"
    value_type: str
    persist: false
  service_light_name:
    initial_value: "Eject Insert"
    value_type: str
    persist: false
  service_light_num:
    initial_value: "Light 1/91"
    value_type: str
    persist: false
  # Servo calibration display
  service_servo_index:
    initial_value: 0
    value_type: int
    persist: false
  service_servo_name:
    initial_value: "Right Ramp"
    value_type: str
    persist: false
  service_servo_num:
    initial_value: "Servo 1/6"
    value_type: str
    persist: false
  service_servo_position:
    initial_value: "Pos: 0.05"
    value_type: str
    persist: false
  service_adjustment_name:
    initial_value: "Balls Per Game"
    value_type: str
    persist: false
  service_adjustment_num:
    initial_value: "Setting 1/15"
    value_type: str
    persist: false
  service_audit_name:
    initial_value: "Games Played"
    value_type: str
    persist: false
  service_audit_num:
    initial_value: "Audit 1/10"
    value_type: str
    persist: false
  service_feature_name:
    initial_value: "Pilot Mode Timer"
    value_type: str
    persist: false
  service_feature_num:
    initial_value: "Feature 1/10"
    value_type: str
    persist: false
  # Audit counters (persistent)
  audit_games_played:
    initial_value: 0
    value_type: int
    persist: true
  audit_balls_played:
    initial_value: 0
    value_type: int
    persist: true
  audit_total_plays:
    initial_value: 0
    value_type: int
    persist: true
  audit_high_score:
    initial_value: 0
    value_type: int
    persist: true
  audit_total_game_time:
    initial_value: 0
    value_type: int
    persist: true

playfields:
  playfield:
    default_source_device: bd_plunger
    enable_ball_search: true
    ball_search_timeout: 15s
    ball_search_wait_after_iteration: 10s
    ball_search_interval: 250ms
    ball_search_block_events: 
      - ball_search_block
      # Rescue Cougar - left lane post hold
      - rescue_cougar_activate_left_lane_post
      # Battle Jester - left lane post hold (step 11)
      - battle_jester_activate_left_lane_post
    ball_search_unblock_events:
      - ball_search_unblock
      # Rescue Cougar - post release events
      - rescue_cougar_deactivate_left_lane_post
      - rescue_cougar_skip_left_lane_post
      - rescue_cougar_cleanup
      - mode_rescue_cougar_stopped
      # Battle Jester - post release events
      - battle_jester_deactivate_left_lane_post
      - battle_jester_cleanup
      - mode_battle_jester_stopped
    tags: default

machine:
  balls_installed: 6
  min_balls: 1

game:
  balls_per_game: 3
  max_players: 4

virtual_platform_start_active_switches:
  - s_trough_1
  - s_trough_2
  - s_trough_3
  - s_trough_4
  - s_trough_5
  - s_trough_6

event_player:
  player_turn_started{number==1}: ui_player_1_up
  player_turn_started{number==2}: ui_player_2_up
  player_turn_started{number==3}: ui_player_3_up
  player_turn_started{number==4}: ui_player_4_up
  
  ##############################################################################
  # SERVICE MODE ENTRY
  # Door must be open (s_coin_door active) AND press ENTER button
  # Only when service mode is not already running
  ##############################################################################
  s_coin_door_service_4_active{device.switches.s_coin_door.state==1 and mode.top_gun_service.active==False}:
    - service_mode_request

##############################################################################
# VOLUME CONTROL
# Only active when NOT in service mode
##############################################################################
variable_player:
  s_coin_door_service_3_active{mode.top_gun_service.active==False}:
    fast_audio_main_volume:
      action: add_machine
      int: 1
  s_coin_door_service_2_active{mode.top_gun_service.active==False}:
    fast_audio_main_volume:
      action: add_machine
      int: -1

slide_player:
  # Show volume overlay when volume changes (3 second display)
  machine_var_fast_audio_main_volume:
    volume_display:
      action: play
      priority: 10000
      expire: 3s

bcp:
  connections:
    local_display:
      type: mpf.core.bcp.bcp_socket_client.BCPClientSocket
      host: localhost
      port: 5050
      required: true
      exit_on_close: true

logging:
  loggers:
    mpf.core.events: debug
    mpf.core.config_player: debug
    mpf.core.assets: debug
    mpf.core.asset_manager: debug
    mpf.plugins.sound: debug
    mpf.devices.servo: debug
    mpf.platforms.fast.fast_servo: debug
    mpf.platforms.fast.fast_exp_board: debug

settings:
  balls_per_game:
    label: Balls Per Game
    values:
      3: "3 Balls (Default)"
      5: "5 Balls"
    default: 3
    key_type: int
    sort: 100
    
  replay_score:
    label: Replay Score
    values:
      0: "Disabled"
      5000000: "5,000,000"
      10000000: "10,000,000"
      15000000: "15,000,000"
      20000000: "20,000,000"
    default: 0
    key_type: int
    sort: 200
    
  free_play:
    label: Free Play
    values:
      1: "Yes - Free Play"
      0: "No - Coins Required"
    default: 1
    key_type: int
    sort: 300
    
  volume_level:
    label: Master Volume
    values:
      5: "5 (Quiet)"
      10: "10"
      15: "15 (Default)"
      20: "20"
      25: "25 (Loud)"
    default: 15
    key_type: int
    sort: 400